%%BoundingBox: 12 26 511 279
%%HiResBoundingBox: 12.256501 26.432757 510.448550 278.533868
%
% Postscript macros for the avatars and connections
%


% Arrow code copied from the Tutorial and Cookbook (p.143)
/arrowdict 14 dict def
  arrowdict begin
    /mtrx matrix def
  end

/arrow
  {arrowdict begin
    /headlength exch def
    /halfheadthickness exch 2 div def
    /halfthickness exch 2 div def
    /tipy exch def /tipx exch def
    /taily exch def /tailx exch def

    /dx tipx tailx sub def
    /dy tipy taily sub def
    /arrowlength dx dx mul dy dy mul add sqrt def
    /angle dy dx atan def

    /base arrowlength headlength sub def
    /savematrix mtrx currentmatrix def

    tailx taily translate
    angle rotate

    0 halfthickness neg moveto
    base halfthickness neg lineto
    base halfheadthickness neg lineto
    arrowlength 0 lineto
    base halfheadthickness lineto
    base halfthickness lineto
    0 halfthickness lineto
    closepath

    savematrix setmatrix
  end
} def


% The following algorithms are copyright Mark Andrew 2003 :-)
/square
{
    newpath
    /ey exch def
    /ex exch def
    /sy exch def
    /sx exch def
    sx sy moveto
    ex sy lineto
    ex ey lineto
    sx ey lineto
    closepath
    gsave 1 1 1 setrgbcolor fill grestore  % paint it all white
    stroke
} def

/oval
{
    /cy exch def
    /cx exch def
    /rx exch def    
    /scaley exch def
    
    gsave
    newpath
    cx cy translate
    1 scaley scale

    0 0  rx
    0 360 arc 

    %1 1 1 setrgbcolor fill


    closepath
    stroke	
    grestore

} def



% Show the string on top of stack centred on current point
% TBD the  y-offset is hardwired assuming a tenpoint font 
/showmiddle { dup stringwidth pop 2 div neg 4 rmoveto show } def

% And now the stuff we always need to do

% this gets us into Tk screen coordinates (700x500)

%306 396 translate
%90 rotate
%-396 -306 translate
1 -1 scale
%0 -500 translate

% TBD Only one font for the whole Kaboodle for the time being

/Times-Roman findfont [10 0 0 -10 0 0] makefont setfont

%
% And now for the code generated by the capsule editor .....
%
10 -305 translate
0.897156988054 0.897156988054 scale
gsave 0.0 0.0 0.0 setrgbcolor
99.0 30.0 554.0 310.0 square
grestore
gsave 0.0 0.0 0.0 setrgbcolor
79.0 189.25970757 119.0 229.25970757 square
grestore
99.0 193.25970757 moveto (p2) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
79.0 78.5846955876 119.0 118.584695588 square
grestore
99.0 82.5846955876 moveto (p1) showmiddle
275.5 225.051718338 moveto (response) show
newpath 275.5 222.401636527 255.500346389 222.283927342 1 5 7 arrow stroke
326 160 moveto (messageFromC2 -> c3act) show
newpath 460 156.913673334 479.999983399 156.887904201 1 5 7 arrow stroke
119.5 113.979181803 moveto (input -> c2act) show
newpath 194.5 111.686939392 214.499693069 111.797741738 1 5 7 arrow stroke
24.0 211.103436677 moveto (response) show
newpath 24.0 209.878548728 4.00175751338 209.878548728 1 5 7 arrow stroke
15.0 97.9583636069 moveto (input) show
newpath 45.0 96.2091330572 64.9795023556 96.2091330572 1 5 7 arrow stroke
gsave 0.0 0.0 0.0 setrgbcolor
467.316062471 106.712745946 557.316062471 243.712745946 square
grestore
512.316062471 175.212745946 moveto (c3) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
234.994406086 56.8317680276 315.994406086 169.831768028 square
grestore
275.494406086 113.331768028 moveto (c2) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
457.316062471 201.427454305 477.316062471 221.427454305 square
grestore
467.316062471 205.427454305 moveto (p2) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
457.316062471 128.254073914 477.316062471 148.254073914 square
grestore
467.316062471 132.254073914 moveto (p1) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
305.994406086 128.449045468 325.994406086 148.449045468 square
grestore
315.994406086 132.449045468 moveto (p2) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
224.994406086 89.338132116 244.994406086 109.338132116 square
grestore
234.994406086 93.338132116 moveto (p1) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor newpath 119.0 98.6954996346 224.994406086 99.2827300925 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 325.994406086 138.43616089 457.316062471 138.266958491 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 457.316062471 211.368598693 119.0 209.377418795 1 5 7 arrow stroke grestore
