%%BoundingBox: 21 25 511 400
%%HiResBoundingBox: 21.623154 25.443280 510.459541 399.503677
%
% Postscript macros for the avatars and connections
%


% Arrow code copied from the Tutorial and Cookbook (p.143)
/arrowdict 14 dict def
  arrowdict begin
    /mtrx matrix def
  end

/arrow
  {arrowdict begin
    /headlength exch def
    /halfheadthickness exch 2 div def
    /halfthickness exch 2 div def
    /tipy exch def /tipx exch def
    /taily exch def /tailx exch def

    /dx tipx tailx sub def
    /dy tipy taily sub def
    /arrowlength dx dx mul dy dy mul add sqrt def
    /angle dy dx atan def

    /base arrowlength headlength sub def
    /savematrix mtrx currentmatrix def

    tailx taily translate
    angle rotate

    0 halfthickness neg moveto
    base halfthickness neg lineto
    base halfheadthickness neg lineto
    arrowlength 0 lineto
    base halfheadthickness lineto
    base halfthickness lineto
    0 halfthickness lineto
    closepath

    savematrix setmatrix
  end
} def


% The following algorithms are copyright Mark Andrew 2003 :-)
/square
{
    newpath
    /ey exch def
    /ex exch def
    /sy exch def
    /sx exch def
    sx sy moveto
    ex sy lineto
    ex ey lineto
    sx ey lineto
    closepath
    gsave 1 1 1 setrgbcolor fill grestore  % paint it all white
    stroke
} def

/oval
{
    /cy exch def
    /cx exch def
    /rx exch def    
    /scaley exch def
    
    gsave
    newpath
    cx cy translate
    1 scaley scale

    0 0  rx
    0 360 arc 

    %1 1 1 setrgbcolor fill


    closepath
    stroke	
    grestore

} def



% Show the string on top of stack centred on current point
% TBD the  y-offset is hardwired assuming a tenpoint font 
/showmiddle { dup stringwidth pop 2 div neg 4 rmoveto show } def

% And now the stuff we always need to do

% this gets us into Tk screen coordinates (700x500)

%306 396 translate
%90 rotate
%-396 -306 translate
1 -1 scale
%0 -500 translate

% TBD Only one font for the whole Kaboodle for the time being

/Times-Roman findfont [10 0 0 -10 0 0] makefont setfont

%
% And now for the code generated by the capsule editor .....
%
10 -445 translate
0.919117647059 0.919117647059 scale
gsave 0.0 0.0 0.0 setrgbcolor
119.0 50.0 544.0 394.45404052 square
grestore
1.0 5.0 190.0 75.0 oval
gsave 0.0 0.0 0.0 setrgbcolor
227.030110109 374.45404052 267.030110109 414.45404052 square
grestore
247.030110109 378.45404052 moveto (accounting) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
99.0 293.061332009 139.0 333.061332009 square
grestore
119.0 297.061332009 moveto (cashSlot) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
99.0 164.635213734 139.0 204.635213734 square
grestore
119.0 168.635213734 moveto (cardSlot) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
99.0 81.3036718579 139.0 121.303671858 square
grestore
119.0 85.3036718579 moveto (keyboard) showmiddle
167 213 moveto (returnCard) show
newpath 183.567502492 202 166.748660654 191.177497553 1 5 7 arrow stroke
162 305 moveto (emitCash) show
newpath 164.768771433 310 145.950148664 316.77195962 1 5 7 arrow stroke
196 332 moveto (withdraw) show
newpath 221.001889943 337 221.0066148 356.999999442 1 5 7 arrow stroke
223 430 moveto (withdraw) show
newpath 248.400177576 435 248.400177576 454.991125139 1 5 7 arrow stroke
44 315 moveto (emitCash) show
newpath 43 313.300292838 23.0045041805 313.300292838 1 5 7 arrow stroke
35 194 moveto (returnCard) show
newpath 34 192.510010523 14.1325887865 192.510010523 1 5 7 arrow stroke
18 176 moveto (insertCard) show
newpath 75 174.468302428 94.7506994726 174.468302428 1 5 7 arrow stroke
23 96 moveto (inputPIN) show
23 106 moveto (inputSum) show
newpath 76 102.350012703 95.9998118055 102.350012703 1 5 7 arrow stroke
gsave 0.0 0.0 1.0 setrgbcolor 
1 setlinewidth
397 276 moveto
397 271 397 271 402 271 curveto
488 271 lineto
493 271 493 271 493 276 curveto
493 301 lineto
493 306 493 306 488 306 curveto
402 306 lineto
397 306 397 306 397 301 curveto
397 276 lineto
closepath stroke
grestore
445 288 moveto (inserted:inputPIN) showmiddle
gsave 0.0 0.0 1.0 setrgbcolor 
1 setlinewidth
191 255 moveto
191 250 191 250 196 250 curveto
298 250 lineto
303 250 303 250 303 255 curveto
303 280 lineto
303 285 303 285 298 285 curveto
196 285 lineto
191 285 191 285 191 280 curveto
191 255 lineto
closepath stroke
grestore
247 267 moveto (authorized:inputSum) showmiddle
gsave 0.0 0.0 1.0 setrgbcolor 
1 setlinewidth
313 99 moveto
313 94 313 94 318 94 curveto
401 94 lineto
406 94 406 94 406 99 curveto
406 124 lineto
406 129 406 129 401 129 curveto
318 129 lineto
313 129 313 129 313 124 curveto
313 99 lineto
closepath stroke
grestore
359 111 moveto (empty:insertCard) showmiddle
gsave 0.0 0.0 1.0 setrgbcolor 
2 setlinewidth
456.0 179.0 moveto
456.0 159.0 456.0 159.0 476.0 159.0 curveto
491.0 159.0 lineto
511.0 159.0 511.0 159.0 511.0 179.0 curveto
511.0 179.0 lineto
511.0 199.0 511.0 199.0 491.0 199.0 curveto
476.0 199.0 lineto
456.0 199.0 456.0 199.0 456.0 179.0 curveto
456.0 179.0 lineto
closepath stroke
grestore
483.5 179.0 moveto (inserted) showmiddle
gsave 0.0 0.0 1.0 setrgbcolor 
2 setlinewidth
316.0 337.0 moveto
316.0 317.0 316.0 317.0 336.0 317.0 curveto
359.0 317.0 lineto
379.0 317.0 379.0 317.0 379.0 337.0 curveto
379.0 341.0 lineto
379.0 361.0 379.0 361.0 359.0 361.0 curveto
336.0 361.0 lineto
316.0 361.0 316.0 361.0 316.0 341.0 curveto
316.0 337.0 lineto
closepath stroke
grestore
347.5 339.0 moveto (authorized) showmiddle
gsave 0.0 0.0 1.0 setrgbcolor 
2 setlinewidth
207.0 131.0 moveto
207.0 111.0 207.0 111.0 227.0 111.0 curveto
227.0 111.0 lineto
247.0 111.0 247.0 111.0 247.0 131.0 curveto
247.0 131.0 lineto
247.0 151.0 247.0 151.0 227.0 151.0 curveto
227.0 151.0 lineto
207.0 151.0 207.0 151.0 207.0 131.0 curveto
207.0 131.0 lineto
closepath stroke
grestore
227.0 131.0 moveto (empty) showmiddle
newpath 333.316287802 187.392254641 moveto 385.316287802 187.392254641 lineto stroke
newpath 333.316287802 228.392254641 moveto 385.316287802 228.392254641 lineto stroke
359.316287802 207.892254641 moveto (cardInfo) showmiddle
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 359.058757849 129 359.249369141 187.392254641 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 381.243207505 228.392254641 425.747094895 270 1 5 7 arrow stroke grestore
gsave 0.0 0.0 1.0 setrgbcolor newpath 247.0 127.96969697 312 118.121212121 1 5 7 arrow stroke grestore
gsave 0.0 0.0 1.0 setrgbcolor newpath 391.955882353 129 456.0 163.979919679 1 5 7 arrow stroke grestore
gsave 0.0 0.0 1.0 setrgbcolor newpath 316.791666667 317.0 272.125 285 1 5 7 arrow stroke grestore
gsave 0.0 0.0 1.0 setrgbcolor newpath 244.352941176 249 229.941176471 151.0 1 5 7 arrow stroke grestore
gsave 0.0 0.0 1.0 setrgbcolor newpath 476.435779817 199.0 451.357798165 270 1 5 7 arrow stroke grestore
gsave 0.0 0.0 1.0 setrgbcolor newpath 410.588235294 306 379.0 322.523076923 1 5 7 arrow stroke grestore
gsave 0.0 0.0 1.0 setrgbcolor newpath 192.756286327 79.1716766033 213.785714286 111.0 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 247.004252372 285 247.025385251 374.45404052 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 196.979735724 285 139.0 305.864248882 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 219.026880607 249 139.0 197.504711588 1 5 7 arrow stroke grestore
