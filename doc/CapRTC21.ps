%%BoundingBox: 12 49 342 351
%%HiResBoundingBox: 12.330000 49.500007 341.401863 350.499997

%
% Postscript macros for the avatars and connections
%


% Arrow code copied from the Tutorial and Cookbook (p.143)
/arrowdict 14 dict def
  arrowdict begin
    /mtrx matrix def
  end

/arrow
  {arrowdict begin
    /headlength exch def
    /halfheadthickness exch 2 div def
    /halfthickness exch 2 div def
    /tipy exch def /tipx exch def
    /taily exch def /tailx exch def

    /dx tipx tailx sub def
    /dy tipy taily sub def
    /arrowlength dx dx mul dy dy mul add sqrt def
    /angle dy dx atan def

    /base arrowlength headlength sub def
    /savematrix mtrx currentmatrix def

    tailx taily translate
    angle rotate

    0 halfthickness neg moveto
    base halfthickness neg lineto
    base halfheadthickness neg lineto
    arrowlength 0 lineto
    base halfheadthickness lineto
    base halfthickness lineto
    0 halfthickness lineto
    closepath

    savematrix setmatrix
  end
} def


% The following algorithms are copyright Mark Andrew 2003 :-)
/square
{
    newpath
    /ey exch def
    /ex exch def
    /sy exch def
    /sx exch def
    sx sy moveto
    ex sy lineto
    ex ey lineto
    sx ey lineto
    closepath
    gsave 1 1 1 setrgbcolor fill grestore  % paint it all white
    stroke
} def

/oval
{
    /cy exch def
    /cx exch def
    /rx exch def    
    /scaley exch def
    
    gsave
    newpath
    cx cy translate
    1 scaley scale

    0 0  rx
    0 360 arc 

    %1 1 1 setrgbcolor fill


    closepath
    stroke	
    grestore

} def



% Show the string on top of stack centred on current point
% TBD the  y-offset is hardwired assuming a tenpoint font 
/showmiddle { dup stringwidth pop 2 div neg 4 rmoveto show } def

% And now the stuff we always need to do

% this gets us into Tk screen coordinates (700x500)

%306 396 translate
%90 rotate
%-396 -306 translate
1 -1 scale
%0 -500 translate

% TBD Only one font for the whole Kaboodle for the time being

/Times-Roman findfont [10 0 0 -10 0 0] makefont setfont

%
% And now for the code generated by the capsule editor .....
%
10 -400 translate
1 1 scale
gsave 0.0 0.0 0.0 setrgbcolor
61.0 50 270.0 350.0 square
grestore
gsave 0.0 0.0 0.0 setrgbcolor
250.0 167.859821397 290.0 207.859821397 square
grestore
270.0 171.859821397 moveto (p2) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
41.0 181.199283016 81.0 221.199283016 square
grestore
61.0 185.199283016 moveto (p1) showmiddle
121 219 moveto (s3) show
newpath 125.986872712 221 125.943115189 240.999952132 1 5 7 arrow stroke
177 167 moveto (s2) show
newpath 188 165.394573732 206.575320968 172.807903006 1 5 7 arrow stroke
185 150 moveto (s1) show
newpath 196 148.394573732 214.575320968 155.807903006 1 5 7 arrow stroke
299 189 moveto (s1) show
299 199 moveto (s2) show
newpath 310 191.301276788 329.915241501 191.301276788 1 5 7 arrow stroke
2 201 moveto (a21) show
newpath 18 197.401353648 37.9325458795 197.401353648 1 5 7 arrow stroke
1.0 20.0 114.654450883 283.937776208 oval
114.654450883 283.937776208 moveto (s3) showmiddle
1.0 20.0 115.0 126.0 oval
115.0 126.0 moveto (a21) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor newpath 133.575320968 133.413329274 250.0 179.877908959 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 133.575320968 133.413329274 250.0 179.877908959 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 114.956242477 145.999952132 114.698208406 263.937824076 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 75.3618390585 181.199283016 103.334328935 142.245372221 1 5 7 arrow stroke grestore
