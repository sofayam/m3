%%BoundingBox: 72 49 415 317
%%HiResBoundingBox: 72.499999 49.500003 414.499993 316.499993
%
% Postscript macros for the avatars and connections
%


% Arrow code copied from the Tutorial and Cookbook (p.143)
/arrowdict 14 dict def
  arrowdict begin
    /mtrx matrix def
  end

/arrow
  {arrowdict begin
    /headlength exch def
    /halfheadthickness exch 2 div def
    /halfthickness exch 2 div def
    /tipy exch def /tipx exch def
    /taily exch def /tailx exch def

    /dx tipx tailx sub def
    /dy tipy taily sub def
    /arrowlength dx dx mul dy dy mul add sqrt def
    /angle dy dx atan def

    /base arrowlength headlength sub def
    /savematrix mtrx currentmatrix def

    tailx taily translate
    angle rotate

    0 halfthickness neg moveto
    base halfthickness neg lineto
    base halfheadthickness neg lineto
    arrowlength 0 lineto
    base halfheadthickness lineto
    base halfthickness lineto
    0 halfthickness lineto
    closepath

    savematrix setmatrix
  end
} def


% The following algorithms are copyright Mark Andrew 2003 :-)
/square
{
    newpath
    /ey exch def
    /ex exch def
    /sy exch def
    /sx exch def
    sx sy moveto
    ex sy lineto
    ex ey lineto
    sx ey lineto
    closepath
    gsave 1 1 1 setrgbcolor fill grestore  % paint it all white
    stroke
} def

/oval
{
    /cy exch def
    /cx exch def
    /rx exch def    
    /scaley exch def
    
    gsave
    newpath
    cx cy translate
    1 scaley scale

    0 0  rx
    0 360 arc 

    %1 1 1 setrgbcolor fill


    closepath
    stroke	
    grestore

} def



% Show the string on top of stack centred on current point
% TBD the  y-offset is hardwired assuming a tenpoint font 
/showmiddle { dup stringwidth pop 2 div neg 4 rmoveto show } def

% And now the stuff we always need to do

% this gets us into Tk screen coordinates (700x500)

%306 396 translate
%90 rotate
%-396 -306 translate
1 -1 scale
%0 -500 translate

% TBD Only one font for the whole Kaboodle for the time being

/Times-Roman findfont [10 0 0 -10 0 0] makefont setfont

%
% And now for the code generated by the capsule editor .....
%
10 -366 translate
1 1 scale
gsave 0.0 0.0 0.0 setrgbcolor
63.0 50 404.0 316.0 square
grestore
240 187 moveto (b) show
newpath 239 183.959161311 219.000667086 183.795812001 1 5 7 arrow stroke
227 163 moveto (a) show
newpath 235 160.032670952 254.999332914 160.196020261 1 5 7 arrow stroke
gsave 0.0 0.0 0.0 setrgbcolor
103.0 130.0 183.0 230.0 square
grestore
143.0 180.0 moveto (c2) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
284.0 130.0 364.0 230.0 square
grestore
324.0 180.0 moveto (c1) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
173.0 163.374991803 193.0 183.374991803 square
grestore
183.0 167.374991803 moveto (p1) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
274.0 164.19993333 294.0 184.19993333 square
grestore
284.0 168.19993333 moveto (p1) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor newpath 193.0 173.456669182 274.0 174.118255951 1 5 7 arrow stroke grestore
