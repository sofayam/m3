%%BoundingBox: 6 13 513 333
%%HiResBoundingBox: 6.084000 13.935713 512.750546 332.040607
%
% Postscript macros for the avatars and connections
%


% Arrow code copied from the Tutorial and Cookbook (p.143)
/arrowdict 14 dict def
  arrowdict begin
    /mtrx matrix def
  end

/arrow
  {arrowdict begin
    /headlength exch def
    /halfheadthickness exch 2 div def
    /halfthickness exch 2 div def
    /tipy exch def /tipx exch def
    /taily exch def /tailx exch def

    /dx tipx tailx sub def
    /dy tipy taily sub def
    /arrowlength dx dx mul dy dy mul add sqrt def
    /angle dy dx atan def

    /base arrowlength headlength sub def
    /savematrix mtrx currentmatrix def

    tailx taily translate
    angle rotate

    0 halfthickness neg moveto
    base halfthickness neg lineto
    base halfheadthickness neg lineto
    arrowlength 0 lineto
    base halfheadthickness lineto
    base halfthickness lineto
    0 halfthickness lineto
    closepath

    savematrix setmatrix
  end
} def


% The following algorithms are copyright Mark Andrew 2003 :-)
/square
{
    newpath
    /ey exch def
    /ex exch def
    /sy exch def
    /sx exch def
    sx sy moveto
    ex sy lineto
    ex ey lineto
    sx ey lineto
    closepath
    gsave 1 1 1 setrgbcolor fill grestore  % paint it all white
    stroke
} def

/oval
{
    /cy exch def
    /cx exch def
    /rx exch def    
    /scaley exch def
    
    gsave
    newpath
    cx cy translate
    1 scaley scale

    0 0  rx
    0 360 arc 

    %1 1 1 setrgbcolor fill


    closepath
    stroke	
    grestore

} def



% Show the string on top of stack centred on current point
% TBD the  y-offset is hardwired assuming a tenpoint font 
/showmiddle { dup stringwidth pop 2 div neg 4 rmoveto show } def

% And now the stuff we always need to do

% this gets us into Tk screen coordinates (700x500)

%306 396 translate
%90 rotate
%-396 -306 translate
1 -1 scale
%0 -500 translate

% TBD Only one font for the whole Kaboodle for the time being

/Times-Roman findfont [10 0 0 -10 0 0] makefont setfont

%
% And now for the code generated by the capsule editor .....
%
10 -346 translate
0.846023688663 0.846023688663 scale
gsave 0.0 0.0 0.0 setrgbcolor
90.0 17.0 470.171014779 392.0 square
grestore
gsave 0.0 0.0 0.0 setrgbcolor
70.0 88.1635838919 110.0 128.163583892 square
grestore
90.0 92.1635838919 moveto (mail) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
450.171014779 159.583727967 490.171014779 199.583727967 square
grestore
470.171014779 163.583727967 moveto (account) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
70.0 318.885653259 110.0 358.885653259 square
grestore
90.0 322.885653259 moveto (admin) showmiddle
165 155 moveto (statement) show
newpath 168.163586146 144 149.202972761 137.636420813 1 5 7 arrow stroke
391 193 moveto (deposit) show
newpath 433 189.979019715 452.999990019 189.959038502 1 5 7 arrow stroke
346 147 moveto (auditTimer -> requestBalance) show
newpath 434.810165691 152 450.309810634 164.639660068 1 5 7 arrow stroke
18 112 moveto (statement) show
newpath 18 110.350233177 -1.99654612006 110.350233177 1 5 7 arrow stroke
489 184 moveto (deposit) show
489 194 moveto (requestBalance) show
newpath 573 191.125011947 592.764594764 191.125011947 1 5 7 arrow stroke
505 166 moveto (updateAccount) show
newpath 505 165.198266121 485.439129009 165.198266121 1 5 7 arrow stroke
-5 313 moveto (setInterestRate) show
newpath 78 312.381569324 95.6354303751 312.381569324 1 5 7 arrow stroke
gsave 0.0 0.0 0.0 setrgbcolor 
313.196939234 65.985271978 moveto
313.196939234 45.985271978 313.196939234 45.985271978 333.196939234 45.985271978 curveto
359.196939234 45.985271978 lineto
379.196939234 45.985271978 379.196939234 45.985271978 379.196939234 65.985271978 curveto
379.196939234 90.985271978 lineto
379.196939234 110.985271978 379.196939234 110.985271978 359.196939234 110.985271978 curveto
333.196939234 110.985271978 lineto
313.196939234 110.985271978 313.196939234 110.985271978 313.196939234 90.985271978 curveto
313.196939234 65.985271978 lineto
closepath stroke
grestore
346.196939234 88.485271978 moveto (auditTimer) showmiddle
newpath 362.696939234 62.235271978 16.5 0 360 arc closepath gsave 1 1 1 setrgbcolor fill grestore stroke
newpath 362.696939234 62.235271978 moveto 362.696939234 45.985271978 lineto stroke
newpath 362.696939234 62.235271978 moveto 375.196939234 62.235271978 lineto stroke
newpath 137.403348528 215.215043559 moveto 206.403348528 215.215043559 lineto stroke
newpath 137.403348528 271.215043559 moveto 206.403348528 271.215043559 lineto stroke
171.903348528 243.215043559 moveto (interestRate) showmiddle
0.598039215686 51.0 303.296757641 179.750445557 oval
303.296757641 179.750445557 moveto (updateAccount) showmiddle
0.586956521739 46.0 297.0 312.0 oval
297.0 312.0 moveto (setInterestRate) showmiddle
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 256.691591881 298.990836819 206.403348528 262.185023724 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 206.403348528 226.55112833 257.373181486 193.015936146 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 379.196939234 105.396132438 450.171014779 163.274115567 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 354.296732188 179.719974206 450.171014779 179.60370919 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 254.947193509 170.045987297 110.0 114.876003008 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 110.0 336.288005601 251.383156007 315.47761432 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 450.171014779 179.60370919 354.296732188 179.719974206 1 5 7 arrow stroke grestore
