%%BoundingBox: 12 29 438 277
%%HiResBoundingBox: 12.186000 29.500004 437.499993 276.500000
%
% Postscript macros for the avatars and connections
%


% Arrow code copied from the Tutorial and Cookbook (p.143)
/arrowdict 14 dict def
  arrowdict begin
    /mtrx matrix def
  end

/arrow
  {arrowdict begin
    /headlength exch def
    /halfheadthickness exch 2 div def
    /halfthickness exch 2 div def
    /tipy exch def /tipx exch def
    /taily exch def /tailx exch def

    /dx tipx tailx sub def
    /dy tipy taily sub def
    /arrowlength dx dx mul dy dy mul add sqrt def
    /angle dy dx atan def

    /base arrowlength headlength sub def
    /savematrix mtrx currentmatrix def

    tailx taily translate
    angle rotate

    0 halfthickness neg moveto
    base halfthickness neg lineto
    base halfheadthickness neg lineto
    arrowlength 0 lineto
    base halfheadthickness lineto
    base halfthickness lineto
    0 halfthickness lineto
    closepath

    savematrix setmatrix
  end
} def


% The following algorithms are copyright Mark Andrew 2003 :-)
/square
{
    newpath
    /ey exch def
    /ex exch def
    /sy exch def
    /sx exch def
    sx sy moveto
    ex sy lineto
    ex ey lineto
    sx ey lineto
    closepath
    gsave 1 1 1 setrgbcolor fill grestore  % paint it all white
    stroke
} def

/oval
{
    /cy exch def
    /cx exch def
    /rx exch def    
    /scaley exch def
    
    gsave
    newpath
    cx cy translate
    1 scaley scale

    0 0  rx
    0 360 arc 

    %1 1 1 setrgbcolor fill


    closepath
    stroke	
    grestore

} def



% Show the string on top of stack centred on current point
% TBD the  y-offset is hardwired assuming a tenpoint font 
/showmiddle { dup stringwidth pop 2 div neg 4 rmoveto show } def

% And now the stuff we always need to do

% this gets us into Tk screen coordinates (700x500)

%306 396 translate
%90 rotate
%-396 -306 translate
1 -1 scale
%0 -500 translate

% TBD Only one font for the whole Kaboodle for the time being

/Times-Roman findfont [10 0 0 -10 0 0] makefont setfont

%
% And now for the code generated by the capsule editor .....
%
10 -306 translate
1 1 scale
gsave 0.0 0.0 0.0 setrgbcolor
92.0 30.0 427.0 276.0 square
grestore
gsave 0.0 0.0 0.0 setrgbcolor
72.0 66.2601394143 112.0 106.260139414 square
grestore
92.0 70.2601394143 moveto (p1) showmiddle
118 152 moveto (done) show
newpath 123.959020251 141 109.780802105 126.894039196 1 5 7 arrow stroke
261 135 moveto (delegate) show
newpath 273.829358683 140 258.10958807 152.364821546 1 5 7 arrow stroke
168 73 moveto (getBusy) show
newpath 215 69.8935888435 234.999803417 69.8049137514 1 5 7 arrow stroke
38 99 moveto (done) show
newpath 37 96.7719138138 17.5677787691 96.7719138138 1 5 7 arrow stroke
2 84 moveto (getBusy) show
newpath 49 82.2036925678 68.9386459985 82.2036925678 1 5 7 arrow stroke
gsave 0.0 0.0 0.0 setrgbcolor
150.0 163.0 230.0 263.0 square
grestore
190.0 213.0 moveto (par2) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
314.0 48.0 394.0 148.0 square
grestore
354.0 98.0 moveto (par1) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
159.132958114 153.0 179.132958114 173.0 square
grestore
169.132958114 157.0 moveto (p2) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
205.186926058 153.0 225.186926058 173.0 square
grestore
215.186926058 157.0 moveto (p1) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
304.0 75.2758362168 324.0 95.2758362168 square
grestore
314.0 79.2758362168 moveto (p1) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor newpath 112.0 86.1714634506 304.0 85.3201741987 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 304.0 93.1416135561 225.186926058 155.134222661 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 159.132958114 153.050963627 112.0 106.158212161 1 5 7 arrow stroke grestore
