%%BoundingBox: 8 20 420 290
%%HiResBoundingBox: 8.028000 20.500004 419.499994 289.499998
%
% Postscript macros for the avatars and connections
%


% Arrow code copied from the Tutorial and Cookbook (p.143)
/arrowdict 14 dict def
  arrowdict begin
    /mtrx matrix def
  end

/arrow
  {arrowdict begin
    /headlength exch def
    /halfheadthickness exch 2 div def
    /halfthickness exch 2 div def
    /tipy exch def /tipx exch def
    /taily exch def /tailx exch def

    /dx tipx tailx sub def
    /dy tipy taily sub def
    /arrowlength dx dx mul dy dy mul add sqrt def
    /angle dy dx atan def

    /base arrowlength headlength sub def
    /savematrix mtrx currentmatrix def

    tailx taily translate
    angle rotate

    0 halfthickness neg moveto
    base halfthickness neg lineto
    base halfheadthickness neg lineto
    arrowlength 0 lineto
    base halfheadthickness lineto
    base halfthickness lineto
    0 halfthickness lineto
    closepath

    savematrix setmatrix
  end
} def


% The following algorithms are copyright Mark Andrew 2003 :-)
/square
{
    newpath
    /ey exch def
    /ex exch def
    /sy exch def
    /sx exch def
    sx sy moveto
    ex sy lineto
    ex ey lineto
    sx ey lineto
    closepath
    gsave 1 1 1 setrgbcolor fill grestore  % paint it all white
    stroke
} def

/oval
{
    /cy exch def
    /cx exch def
    /rx exch def    
    /scaley exch def
    
    gsave
    newpath
    cx cy translate
    1 scaley scale

    0 0  rx
    0 360 arc 

    %1 1 1 setrgbcolor fill


    closepath
    stroke	
    grestore

} def



% Show the string on top of stack centred on current point
% TBD the  y-offset is hardwired assuming a tenpoint font 
/showmiddle { dup stringwidth pop 2 div neg 4 rmoveto show } def

% And now the stuff we always need to do

% this gets us into Tk screen coordinates (700x500)

%306 396 translate
%90 rotate
%-396 -306 translate
1 -1 scale
%0 -500 translate

% TBD Only one font for the whole Kaboodle for the time being

/Times-Roman findfont [10 0 0 -10 0 0] makefont setfont

%
% And now for the code generated by the capsule editor .....
%
10 -310 translate
1 1 scale
gsave 0.0 0.0 0.0 setrgbcolor
118.0 21.0 409.0 289.0 square
grestore
gsave 0.0 0.0 0.0 setrgbcolor
98.0 213.466257717 138.0 253.466257717 square
grestore
118.0 217.466257717 moveto (information) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
98.0 78.1967157516 138.0 118.196715752 square
grestore
118.0 82.1967157516 moveto (movement) showmiddle
171 247 moveto (balance) show
newpath 170 243.916424696 150.000144313 243.840447695 1 5 7 arrow stroke
39 245 moveto (balance) show
newpath 38 243.111842794 18.2130300077 243.111842794 1 5 7 arrow stroke
-2 223 moveto (requestBalance) show
newpath 82 222.131066574 101.70844107 222.131066574 1 5 7 arrow stroke
18 95 moveto (deposit) show
18 105 moveto (withdraw) show
newpath 69 101.300375713 88.994221467 101.300375713 1 5 7 arrow stroke
newpath 311.31481671 111.813181044 moveto 366.31481671 111.813181044 lineto stroke
newpath 311.31481671 152.813181044 moveto 366.31481671 152.813181044 lineto stroke
338.81481671 132.313181044 moveto (money) showmiddle
0.985074626866 33.5 258.5 234.0 oval
258.5 234.0 moveto (requestBalance) showmiddle
0.962962962963 27.0 218.0 149.0 oval
218.0 149.0 moveto (withdraw) showmiddle
1.04347826087 23.0 236.0 50.0 oval
236.0 50.0 moveto (deposit) showmiddle
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 313.208908691 111.813181044 253.95475715 64.9994944289 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 253.95475715 64.9994944289 313.208908691 111.813181044 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 311.31481671 136.111452926 244.746089636 145.442677541 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 244.746089636 145.442677541 311.31481671 136.111452926 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 322.623399185 152.813181044 279.263776762 208.103297189 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 225.000241725 233.874637948 138.0 233.542235266 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 138.0 90.0277808784 214.707616645 59.0749265873 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 138.0 108.357372601 193.928306938 137.223723078 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 138.0 233.542235266 225.000241725 233.874637948 1 5 7 arrow stroke grestore
