%%BoundingBox: 30 63 529 343
%%HiResBoundingBox: 30.557275 63.103832 528.887599 342.703093
%
% Postscript macros for the avatars and connections
%


% Arrow code copied from the Tutorial and Cookbook (p.143)
/arrowdict 14 dict def
  arrowdict begin
    /mtrx matrix def
  end

/arrow
  {arrowdict begin
    /headlength exch def
    /halfheadthickness exch 2 div def
    /halfthickness exch 2 div def
    /tipy exch def /tipx exch def
    /taily exch def /tailx exch def

    /dx tipx tailx sub def
    /dy tipy taily sub def
    /arrowlength dx dx mul dy dy mul add sqrt def
    /angle dy dx atan def

    /base arrowlength headlength sub def
    /savematrix mtrx currentmatrix def

    tailx taily translate
    angle rotate

    0 halfthickness neg moveto
    base halfthickness neg lineto
    base halfheadthickness neg lineto
    arrowlength 0 lineto
    base halfheadthickness lineto
    base halfthickness lineto
    0 halfthickness lineto
    closepath

    savematrix setmatrix
  end
} def


% The following algorithms are copyright Mark Andrew 2003 :-)
/square
{
    newpath
    /ey exch def
    /ex exch def
    /sy exch def
    /sx exch def
    sx sy moveto
    ex sy lineto
    ex ey lineto
    sx ey lineto
    closepath
    gsave 1 1 1 setrgbcolor fill grestore  % paint it all white
    stroke
} def

/oval
{
    /cy exch def
    /cx exch def
    /rx exch def    
    /scaley exch def
    
    gsave
    newpath
    cx cy translate
    1 scaley scale

    0 0  rx
    0 360 arc 

    %1 1 1 setrgbcolor fill


    closepath
    stroke	
    grestore

} def



% Show the string on top of stack centred on current point
% TBD the  y-offset is hardwired assuming a tenpoint font 
/showmiddle { dup stringwidth pop 2 div neg 4 rmoveto show } def

% And now the stuff we always need to do

% this gets us into Tk screen coordinates (700x500)

%306 396 translate
%90 rotate
%-396 -306 translate
1 -1 scale
%0 -500 translate

% TBD Only one font for the whole Kaboodle for the time being

/Times-Roman findfont [10 0 0 -10 0 0] makefont setfont

%
% And now for the code generated by the capsule editor .....
%
10 -406 translate
0.910746812386 0.910746812386 scale
gsave 0.0 0.0 0.0 setrgbcolor
136.0 70.0 472.0 376.0 square
grestore
gsave 0.0 0.0 0.0 setrgbcolor
452.0 185.28251858 492.0 225.28251858 square
grestore
472.0 189.28251858 moveto (accounting) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
116.0 264.511505708 156.0 304.511505708 square
grestore
136.0 268.511505708 moveto (cashSlot) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
116.0 114.481877988 156.0 154.481877988 square
grestore
136.0 118.481877988 moveto (cardSlot) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
116.0 196.507080735 156.0 236.507080735 square
grestore
136.0 200.507080735 moveto (keyboard) showmiddle
208.0 251.096037421 moveto (returnCard) show
newpath 230.147805247 241.096037421 216.147101821 226.813870093 1 5 7 arrow stroke
209.0 313.007957088 moveto (emitCash) show
newpath 209.0 306.356776491 189.259856787 303.143251021 1 5 7 arrow stroke
380.5 272.638738479 moveto (withdraw) show
newpath 417.209879623 262.638738479 433.832557353 251.517291401 1 5 7 arrow stroke
498.0 222.277476958 moveto (withdraw) show
newpath 549.0 221.102015542 568.251987302 221.102015542 1 5 7 arrow stroke
49.0 289.015914176 moveto (emitCash) show
newpath 49.0 287.791591174 29.0106139344 287.791591174 1 5 7 arrow stroke
44.0 132.192074843 moveto (returnCard) show
newpath 44.0 131.171399991 24.0584746188 131.171399991 1 5 7 arrow stroke
25.0 148.192074843 moveto (insertCard) show
newpath 82.0 147.130170054 101.81788116 147.130170054 1 5 7 arrow stroke
26.0 210.719888093 moveto (inputPIN) show
26.0 220.719888093 moveto (inputSum) show
newpath 79.0 217.044946973 98.9991112898 217.044946973 1 5 7 arrow stroke
newpath 226.0 154.0 moveto 266.0 154.0 lineto stroke
newpath 226.0 194.0 moveto 266.0 194.0 lineto stroke
246.0 174.0 moveto (cardState) showmiddle
newpath 348.0 97.0 moveto 398.0 97.0 lineto stroke
newpath 348.0 137.0 moveto 398.0 137.0 lineto stroke
373.0 117.0 moveto (cardInfo) showmiddle
0.9375 32.0 311.0 313.0 oval
311.0 313.0 moveto (inputSum) showmiddle
0.9 30.0 249.0 106.0 oval
249.0 106.0 moveto (insertCard) showmiddle
0.881355932203 29.5 350.5 217.0 oval
350.5 217.0 moveto (inputPIN) showmiddle
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 266.0 182.229665072 323.219293607 207.106291543 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 368.5 137.0 356.975609756 191.634146341 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 323.219293607 207.106291543 266.0 182.229665072 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 247.677756748 132.973762343 246.882352941 154.0 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 278.882651045 108.385792301 348.0 114.782258065 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 255.352517986 194.0 297.444836351 285.824503645 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 297.444836351 285.824503645 255.352517986 194.0 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 337.596284367 296.317829384 452.0 218.663572173 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 279.41577086 308.179711795 156.0 287.767333627 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 288.598874519 291.576749008 155.605852675 154.481877988 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 156.0 216.553040573 321.000077891 216.940252368 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 156.0 129.440837636 219.909824763 112.599013624 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 156.0 227.534842937 282.9775322 298.514447912 1 5 7 arrow stroke grestore
