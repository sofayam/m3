%%BoundingBox: 19 49 331 426
%%HiResBoundingBox: 19.475999 49.500003 330.499994 425.499996

%
% Postscript macros for the avatars and connections
%


% Arrow code copied from the Tutorial and Cookbook (p.143)
/arrowdict 14 dict def
  arrowdict begin
    /mtrx matrix def
  end

/arrow
  {arrowdict begin
    /headlength exch def
    /halfheadthickness exch 2 div def
    /halfthickness exch 2 div def
    /tipy exch def /tipx exch def
    /taily exch def /tailx exch def

    /dx tipx tailx sub def
    /dy tipy taily sub def
    /arrowlength dx dx mul dy dy mul add sqrt def
    /angle dy dx atan def

    /base arrowlength headlength sub def
    /savematrix mtrx currentmatrix def

    tailx taily translate
    angle rotate

    0 halfthickness neg moveto
    base halfthickness neg lineto
    base halfheadthickness neg lineto
    arrowlength 0 lineto
    base halfheadthickness lineto
    base halfthickness lineto
    0 halfthickness lineto
    closepath

    savematrix setmatrix
  end
} def


% The following algorithms are copyright Mark Andrew 2003 :-)
/square
{
    newpath
    /ey exch def
    /ex exch def
    /sy exch def
    /sx exch def
    sx sy moveto
    ex sy lineto
    ex ey lineto
    sx ey lineto
    closepath
    gsave 1 1 1 setrgbcolor fill grestore  % paint it all white
    stroke
} def

/oval
{
    /cy exch def
    /cx exch def
    /rx exch def    
    /scaley exch def
    
    gsave
    newpath
    cx cy translate
    1 scaley scale

    0 0  rx
    0 360 arc 

    %1 1 1 setrgbcolor fill


    closepath
    stroke	
    grestore

} def



% Show the string on top of stack centred on current point
% TBD the  y-offset is hardwired assuming a tenpoint font 
/showmiddle { dup stringwidth pop 2 div neg 4 rmoveto show } def

% And now the stuff we always need to do

% this gets us into Tk screen coordinates (700x500)

%306 396 translate
%90 rotate
%-396 -306 translate
1 -1 scale
%0 -500 translate

% TBD Only one font for the whole Kaboodle for the time being

/Times-Roman findfont [10 0 0 -10 0 0] makefont setfont

%
% And now for the code generated by the capsule editor .....
%
10 -475 translate
1 1 scale
gsave 0.0 0.0 0.0 setrgbcolor
62.0 50 320.0 425.0 square
grestore
gsave 0.0 0.0 0.0 setrgbcolor
42.0 188.282389225 82.0 228.282389225 square
grestore
62.0 192.282389225 moveto (p1) showmiddle
83 287 moveto (s2) show
newpath 91.0747087646 289 100.195840343 306.799015667 1 5 7 arrow stroke
100 193 moveto (s1) show
newpath 111 183.319007116 125.522941549 169.568219183 1 5 7 arrow stroke
227 236 moveto (s4) show
newpath 231.987374619 238 231.94529011 257.999955722 1 5 7 arrow stroke
9 205 moveto (s1) show
9 215 moveto (s2) show
newpath 20 207.300107046 39.9928661359 207.300107046 1 5 7 arrow stroke
gsave 0.0 0.0 0.0 setrgbcolor
138.0 292.0 278.0 403.0 square
grestore
208.0 347.5 moveto (capRTC222) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
137.0 86.0 291.0 191.0 square
grestore
214.0 138.5 moveto (capRTC221) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
234.770630126 282.0 254.770630126 302.0 square
grestore
244.770630126 286.0 moveto (p2) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
128.0 346.589118386 148.0 366.589118386 square
grestore
138.0 350.589118386 moveto (p1) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
234.983157368 181.0 254.983157368 201.0 square
grestore
244.983157368 185.0 moveto (p2) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor
127.0 127.269978172 147.0 147.269978172 square
grestore
137.0 131.269978172 moveto (p1) showmiddle
gsave 0.0 0.0 0.0 setrgbcolor newpath 244.962115067 201.0 244.791672427 282.0 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 82.0 189.345746278 127.0 146.738299646 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 72.2490292153 228.282389225 132.875485392 346.589118386 1 5 7 arrow stroke grestore
0.926100797973 10.0983606557 245.557377049 110.783064633 oval
gsave 0.0 0.0 0.0 setrgbcolor newpath 245.521152053 120.135104322 245.282883092 181.647900138 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 147.098360656 133.352016387 235.754818347 113.030024663 1 5 7 arrow stroke grestore
0.840608270865 13.5759835109 208.184963873 379.60522775 oval
0.840608270865 13.5759835109 241.856273859 371.31398397 oval
gsave 0.0 0.0 0.0 setrgbcolor newpath 151.575983511 360.720064043 195.566380541 375.395577435 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 241.989924778 303.412084024 241.878736167 359.901915566 1 5 7 arrow stroke grestore
