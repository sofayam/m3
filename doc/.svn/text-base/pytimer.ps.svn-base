%%BoundingBox: 11 47 345 283
%%HiResBoundingBox: 11.654116 47.500003 344.499990 282.499994
%
% Postscript macros for the avatars and connections
%


% Arrow code copied from the Tutorial and Cookbook (p.143)
/arrowdict 14 dict def
  arrowdict begin
    /mtrx matrix def
  end

/arrow
  {arrowdict begin
    /headlength exch def
    /halfheadthickness exch 2 div def
    /halfthickness exch 2 div def
    /tipy exch def /tipx exch def
    /taily exch def /tailx exch def

    /dx tipx tailx sub def
    /dy tipy taily sub def
    /arrowlength dx dx mul dy dy mul add sqrt def
    /angle dy dx atan def

    /base arrowlength headlength sub def
    /savematrix mtrx currentmatrix def

    tailx taily translate
    angle rotate

    0 halfthickness neg moveto
    base halfthickness neg lineto
    base halfheadthickness neg lineto
    arrowlength 0 lineto
    base halfheadthickness lineto
    base halfthickness lineto
    0 halfthickness lineto
    closepath

    savematrix setmatrix
  end
} def


% The following algorithms are copyright Mark Andrew 2003 :-)
/square
{
    newpath
    /ey exch def
    /ex exch def
    /sy exch def
    /sx exch def
    sx sy moveto
    ex sy lineto
    ex ey lineto
    sx ey lineto
    closepath
    gsave 1 1 1 setrgbcolor fill grestore  % paint it all white
    stroke
} def

/oval
{
    /cy exch def
    /cx exch def
    /rx exch def    
    /scaley exch def
    
    gsave
    newpath
    cx cy translate
    1 scaley scale

    0 0  rx
    0 360 arc 

    %1 1 1 setrgbcolor fill


    closepath
    stroke	
    grestore

} def



% Show the string on top of stack centred on current point
% TBD the  y-offset is hardwired assuming a tenpoint font 
/showmiddle { dup stringwidth pop 2 div neg 4 rmoveto show } def

% And now the stuff we always need to do

% this gets us into Tk screen coordinates (700x500)

%306 396 translate
%90 rotate
%-396 -306 translate
1 -1 scale
%0 -500 translate

% TBD Only one font for the whole Kaboodle for the time being

/Times-Roman findfont [10 0 0 -10 0 0] makefont setfont

%
% And now for the code generated by the capsule editor .....
%
10 -330 translate
1 1 scale
gsave 0.0 0.0 0.0 setrgbcolor
65.0 48.0 334.0 282.0 square
grestore
gsave 0.0 0.0 0.0 setrgbcolor
45.0 147.127936098 85.0 187.127936098 square
grestore
65.0 151.127936098 moveto (p1) showmiddle
114.5 179.90575625 moveto (foo) show
newpath 114.5 177.396761541 94.5000080905 177.37877213 1 5 7 arrow stroke
206.0 109.0 moveto (myTimer) show
newpath 218.638042263 114.0 201.946602425 125.01797786 1 5 7 arrow stroke
23.0 165.811512499 moveto (foo) show
newpath 23.0 163.815055874 3.14073760594 163.815055874 1 5 7 arrow stroke
gsave 0.0 0.0 0.0 setrgbcolor 
1 setlinewidth
260.749055823 78.2510355 moveto
260.749055823 58.2510355 260.749055823 58.2510355 280.749055823 58.2510355 curveto
298.749055823 58.2510355 lineto
318.749055823 58.2510355 318.749055823 58.2510355 318.749055823 78.2510355 curveto
318.749055823 96.2510355 lineto
318.749055823 116.2510355 318.749055823 116.2510355 298.749055823 116.2510355 curveto
280.749055823 116.2510355 lineto
260.749055823 116.2510355 260.749055823 116.2510355 260.749055823 96.2510355 curveto
260.749055823 78.2510355 lineto
closepath stroke
grestore
289.749055823 97.2510355 moveto (myTimer) showmiddle
newpath 304.249055823 72.7510355 14.5 0 360 arc closepath gsave 1 1 1 setrgbcolor fill grestore stroke
newpath 304.249055823 72.7510355 moveto 304.249055823 58.2510355 lineto stroke
newpath 304.249055823 72.7510355 moveto 314.749055823 72.7510355 lineto stroke
newpath 264.267032496 211.481033859 moveto 304.267032496 211.481033859 lineto stroke
newpath 264.267032496 251.481033859 moveto 304.267032496 251.481033859 lineto stroke
284.267032496 231.481033859 moveto (i) showmiddle
1.0 24.5 168.600157626 167.221121425 oval
168.600157626 167.221121425 moveto (timeact) showmiddle
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 190.016968639 179.11944929 264.267032496 220.369829807 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 264.267032496 220.369829807 190.016968639 179.11944929 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 264.267032496 220.369829807 190.016968639 179.11944929 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 260.749055823 106.393863263 189.047171428 153.724098546 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 144.100167536 167.199084397 85.0 167.145925516 1 5 7 arrow stroke grestore
