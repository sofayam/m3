%%BoundingBox: 14 53 350 293
%%HiResBoundingBox: 14.845957 53.500002 349.499991 292.499995
%
% Postscript macros for the avatars and connections
%


% Arrow code copied from the Tutorial and Cookbook (p.143)
/arrowdict 14 dict def
  arrowdict begin
    /mtrx matrix def
  end

/arrow
  {arrowdict begin
    /headlength exch def
    /halfheadthickness exch 2 div def
    /halfthickness exch 2 div def
    /tipy exch def /tipx exch def
    /taily exch def /tailx exch def

    /dx tipx tailx sub def
    /dy tipy taily sub def
    /arrowlength dx dx mul dy dy mul add sqrt def
    /angle dy dx atan def

    /base arrowlength headlength sub def
    /savematrix mtrx currentmatrix def

    tailx taily translate
    angle rotate

    0 halfthickness neg moveto
    base halfthickness neg lineto
    base halfheadthickness neg lineto
    arrowlength 0 lineto
    base halfheadthickness lineto
    base halfthickness lineto
    0 halfthickness lineto
    closepath

    savematrix setmatrix
  end
} def


% The following algorithms are copyright Mark Andrew 2003 :-)
/square
{
    newpath
    /ey exch def
    /ex exch def
    /sy exch def
    /sx exch def
    sx sy moveto
    ex sy lineto
    ex ey lineto
    sx ey lineto
    closepath
    gsave 1 1 1 setrgbcolor fill grestore  % paint it all white
    stroke
} def

/oval
{
    /cy exch def
    /cx exch def
    /rx exch def    
    /scaley exch def
    
    gsave
    newpath
    cx cy translate
    1 scaley scale

    0 0  rx
    0 360 arc 

    %1 1 1 setrgbcolor fill


    closepath
    stroke	
    grestore

} def



% Show the string on top of stack centred on current point
% TBD the  y-offset is hardwired assuming a tenpoint font 
/showmiddle { dup stringwidth pop 2 div neg 4 rmoveto show } def

% And now the stuff we always need to do

% this gets us into Tk screen coordinates (700x500)

%306 396 translate
%90 rotate
%-396 -306 translate
1 -1 scale
%0 -500 translate

% TBD Only one font for the whole Kaboodle for the time being

/Times-Roman findfont [10 0 0 -10 0 0] makefont setfont

%
% And now for the code generated by the capsule editor .....
%
10 -346 translate
1 1 scale
gsave 0.0 0.0 0.0 setrgbcolor
81.0 54.0 339.0 292.0 square
grestore
gsave 0.0 0.0 0.0 setrgbcolor
61.0 97.7083189758 101.0 137.708318976 square
grestore
81.0 101.708318976 moveto (p1) showmiddle
120.0 179.910584108 moveto (alarm) show
newpath 131.097416309 169.910584108 121.865550892 152.168750468 1 5 7 arrow stroke
179.0 195.0 moveto (isZero) show
newpath 193.223604522 200.0 184.229073454 217.863325862 1 5 7 arrow stroke
26.0 112.821168217 moveto (alarm) show
newpath 26.0 111.083850827 6.33257898664 111.083850827 1 5 7 arrow stroke
11.0 130.821168217 moveto (dec) show
newpath 32.0 128.85445423 51.6892469416 128.85445423 1 5 7 arrow stroke
gsave 0.0 0.0 0.0 setrgbcolor 
1 setlinewidth
184.846728258 135.765538622 moveto
184.846728258 115.765538622 184.846728258 115.765538622 204.846728258 115.765538622 curveto
204.846728258 115.765538622 lineto
224.846728258 115.765538622 224.846728258 115.765538622 224.846728258 135.765538622 curveto
224.846728258 135.765538622 lineto
224.846728258 155.765538622 224.846728258 155.765538622 204.846728258 155.765538622 curveto
204.846728258 155.765538622 lineto
184.846728258 155.765538622 184.846728258 155.765538622 184.846728258 135.765538622 curveto
184.846728258 135.765538622 lineto
closepath stroke
grestore
204.846728258 145.765538622 moveto (isZero) showmiddle
214.846728258 125.765538622 moveto (@) showmiddle
newpath 276.115576607 229.407681863 moveto 316.115576607 229.407681863 lineto stroke
newpath 276.115576607 269.407681863 moveto 316.115576607 269.407681863 lineto stroke
296.115576607 249.407681863 moveto (counter) showmiddle
0.979591836735 24.5 148.561732775 247.548710849 oval
148.561732775 247.548710849 moveto (handler) showmiddle
1.0 20.0 271.64510998 86.0240565184 oval
271.64510998 86.0240565184 moveto (dec) showmiddle
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 274.607529137 105.803441563 293.120115272 229.407681863 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 293.120115272 229.407681863 274.607529137 105.803441563 1 5 7 arrow stroke grestore
gsave 0.501960784314 0.541176470588 0.529411764706 setrgbcolor newpath 280.053076245 229.407681863 220.909228621 155.765538622 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 194.776340317 155.765538622 159.580033334 226.112719814 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 137.25269764 226.25851048 91.4068898439 137.708318976 1 5 7 arrow stroke grestore
gsave 0.0 0.0 0.0 setrgbcolor newpath 101.0 114.384419143 251.915724523 89.3029815693 1 5 7 arrow stroke grestore
